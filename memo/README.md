# Incident 管理系统设计文档

## 系统概述
该系统是一个集中化的事件管理平台，用于接收、处理和管理来自各种日志监控系统的告警信息，并根据预定义的规则自动创建和管理事件（Incidents）。

## 核心功能

### 1. Webhook 接入
- 支持接收来自多个日志管理平台的 webhook 告警
- 支持的告警源：
  - Prometheus AlertManager
  - Grafana
  - ELK Stack
  - 自定义 webhook 格式

### 2. 事件（Incident）管理
- 事件创建规则配置
  - 基于告警级别
  - 基于关键字匹配
  - 基于服务影响范围
  - 基于时间窗口的告警聚合
- 事件状态管理
  - 新建（New）
  - 处理中（In Progress）
  - 已解决（Resolved）
  - 已关闭（Closed）

### 3. 通知系统
- 支持多渠道通知
  - 电子邮件
  - Slack
  - 钉钉/企业微信
  - SMS（可选）
- 通知规则配置
  - 按严重程度配置通知方式
  - 按时间配置通知升级策略
  - 值班人员轮换制度

### 4. 配置管理
- 告警规则配置
  - 匹配条件设置
  - 优先级定义
  - 自动分类规则
- 团队和用户管理
  - 用户角色权限
  - 团队分组
  - 值班排班

## 技术架构

### 管理系统架构
    #### 前端架构
    - 框架：Vue3 + TypeScript
    - UI 组件库：PrimeVue
    - 路由：Vue Router + unplugin-vue-router
    - 状态管理：Pinia

    #### 后端架构
    - 管理后台服务端：tRPC + AWS Lambda
    - 数据库：PostgreSQL

### 告警处理架构
    #### 告警处理服务端
    - 告警处理服务端：Typescript + AWS Lambda
    - 数据库：PostgreSQL
    - 消息队列：AWS SQS
    #### 移动端应用
    - 移动端应用：tauri + Vue3 + TypeScript

## UI 设计

### Web端界面设计

#### 1. 主控制台（Dashboard）
- 布局：响应式三栏布局
  - 左侧：导航菜单
  - 中间：主要内容区
  - 右侧：快速操作面板（可折叠）
- 顶部状态栏
  - 实时统计数据
  - 未处理事件计数
  - 全局搜索
  - 用户信息

#### 2. Incident 列表页面
- 表格视图
  - 支持多列排序
  - 自定义列显示
  - 批量操作
  - 快速过滤器
- 看板视图（类似 Trello）
  - 按状态分列显示
  - 拖拽排序
  - 快速状态更新

#### 3. Incident 详情页面
- 分区布局
  - 基本信息区
  - 时间线展示
  - 相关告警信息
  - 处理记录
  - 评论区域
- 右侧操作面板
  - 快速更新状态
  - 分配处理人
  - 添加标签
  - 关联其他 Incident

#### 4. 配置管理界面
- 表单设计
  - 分步骤配置向导
  - 实时验证
  - 配置预览
- 规则编辑器
  - 可视化规则构建器
  - JSON 编辑模式
  - 规则测试工具

### 移动端界面设计

#### 1. 首页
- 顶部：快速统计卡片
  - 今日新增事件
  - 待处理事件
  - 严重程度分布
- 中部：最新事件列表
  - 下拉刷新
  - 无限滚动
  - 快速操作滑动手势

#### 2. Incident 详情
- 手风琴式展开面板
  - 基本信息
  - 处理记录
  - 相关告警
- 底部操作栏
  - 快速更新状态
  - 添加评论
  - 分享功能

#### 3. 通知中心
- 分类标签页
  - 全部通知
  - 未读消息
  - 重要提醒
- 通知卡片
  - 优先级标识
  - 快速预览
  - 直接操作按钮

#### 4. 个人中心
- 值班信息
- 待处理任务
- 个人设置
- 通知偏好

### 设计规范

#### 1. 配色方案
- 主色调：#1890ff（科技蓝）
- 警告色：#faad14（警告黄）
- 错误色：#f5222d（错误红）
- 成功色：#52c41a（成功绿）
- 背景色：#f0f2f5（浅灰底）

#### 2. 字体系统
- 标题：系统默认无衬线字体，16-24px
- 正文：系统默认无衬线字体，14px
- 辅助文字：系统默认无衬线字体，12px

#### 3. 响应式断点
- 移动端：< 768px
- 平板：768px - 1024px
- 桌面：> 1024px

#### 4. 交互设计
- 加载状态：骨架屏 + 进度指示
- 操作反馈：轻提示 + 动效
- 表单验证：实时验证 + 错误提示
- 页面转场：平滑过渡动画

### 无障碍设计
- 支持键盘导航
- 适当的颜色对比度
- 支持屏幕阅读器
- 可调整文字大小

### 性能优化
- 图片懒加载
- 组件按需加载
- 虚拟滚动列表
- 请求数据缓存

## API 接口设计

### Webhook 接收端点
```
POST /api/v1/webhooks/{source}
```

### Incident 管理接口
```
GET    /api/v1/incidents
POST   /api/v1/incidents
GET    /api/v1/incidents/{id}
PUT    /api/v1/incidents/{id}
DELETE /api/v1/incidents/{id}
```

### 配置管理接口
```
GET    /api/v1/configs
POST   /api/v1/configs
PUT    /api/v1/configs/{id}
DELETE /api/v1/configs/{id}
```

## 部署架构
- 使用 AWS Lambda 部署告警处理服务
- 使用 AWS SQS 作为消息队列
- 使用 AWS RDS 作为数据库
- 使用 AWS CloudWatch 进行监控和告警
- 使用 AWS CloudFront 作为 CDN
- 使用 AWS S3 作为静态文件存储
- 使用 AWS Route 53 作为域名解析

## 安全考虑
- API 认证和授权
- Webhook 签名验证
- 数据加密存储
- 审计日志
- RBAC 权限控制

## 监控和告警
- 系统健康检查
- 性能监控
- API 调用统计
- 错误率监控
- 响应时间监控

## 后续规划
1. 集成机器学习模型进行智能告警分类
2. 添加自动化处理流程
3. 提供更丰富的数据分析和可视化功能
4. 支持更多的告警源集成
5. 提供移动端应用 